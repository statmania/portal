<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bangladesh Daily Rainfall Dashboard</title>
    <!-- Tailwind CSS for utility-first styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter font for modern typography -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the dashboard */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light gray background */
            color: #334155; /* Dark gray text */
            padding: 1.5rem; /* Overall page padding */
        }
        .dashboard-box {
            /* Common styles for the top three summary boxes */
            @apply bg-white rounded-xl shadow-lg p-6 flex flex-col items-center justify-center transition-all duration-300 ease-in-out transform hover:scale-105 hover:shadow-xl;
            border-bottom: 5px solid; /* Placeholder for dynamic border color */
        }
        .top-box-icon {
            /* Styling for icons in the top boxes */
            @apply text-5xl mb-4;
        }
        .number-display {
            /* Styling for large numbers in the top boxes */
            @apply text-5xl font-extrabold text-blue-600;
        }
        .month-box {
            /* Common styles for monthly data boxes */
            /* Changed from flex-col to flex for horizontal alignment */
            @apply bg-white rounded-lg shadow-md p-4 flex items-center justify-start text-left transition-all duration-200 ease-in-out hover:shadow-lg;
            border-bottom: 4px solid; /* Placeholder for dynamic border color */
        }
        .month-icon {
            /* Styling for icons in monthly boxes */
            @apply text-4xl mr-4 flex-shrink-0 flex items-center justify-center; /* Added mr-4 for spacing, flex-shrink-0 to prevent shrinking */
            height: 2.5rem; /* Fixed height for consistent icon alignment */
        }
        .month-content {
            /* New container for text content to allow centering */
            @apply flex-grow text-center;
        }
        .month-title {
            /* Styling for month names */
            @apply text-lg font-semibold text-gray-700;
        }
        .month-data {
            /* Styling for data values in monthly boxes - increased size and specific colors */
            @apply text-2xl font-bold; /* Increased font size */
        }
        .footer {
            /* Styling for the footer */
            @apply text-center py-6 text-gray-500 text-sm mt-10;
        }
        .loading-spinner {
            /* CSS for the loading spinner animation */
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3b82f6; /* Blue spinner color */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-6">
    <h1 class="text-4xl font-bold text-center mb-10 text-gray-800">Bangladesh Daily Rainfall Dashboard 2024</h1>

    <!-- Loading indicator, hidden once data is loaded -->
    <div id="loading" class="flex justify-center items-center h-64">
        <div class="loading-spinner"></div>
        <p class="ml-4 text-xl text-gray-600">Loading data...</p>
    </div>

    <!-- Dashboard content, hidden until data is loaded -->
    <div id="dashboard-content" class="hidden">
        <!-- Top Summary Boxes -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <!-- Monthly Lowest Rainfall Box -->
            <div class="dashboard-box border-blue-500">
                <div class="top-box-icon text-blue-500">
                    <!-- SVG for rainfall icon (down arrow) -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-12 h-12">
                        <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm.53 5.47a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 1 0 1.06 1.06L11.25 9.81v4.319c0 .414.336.75.75.75s.75-.336.75-.75V9.81l1.72 1.72a.75.75 0 1 0 1.06-1.06l-3-3Z" clip-rule="evenodd" />
                    </svg>
                </div>
                <p class="text-lg font-medium text-gray-600 mb-2">Monthly Lowest Rainfall</p>
                <div class="number-display" id="lowestRainfallVal">0.0</div>
                <p class="text-sm text-gray-500" id="lowestRainfallInfo">in __ station in the month of __</p>
            </div>

            <!-- Monthly Highest Rainfall Box -->
            <div class="dashboard-box border-red-500">
                <div class="top-box-icon text-red-500">
                    <!-- SVG for rainfall icon (up arrow) -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-12 h-12">
                        <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-.53 14.22a.75.75 0 0 0 1.06 0l3-3a.75.75 0 1 0-1.06-1.06L12.75 14.19V9.81c0-.414-.336-.75-.75-.75s-.75.336-.75.75v4.38l-1.72-1.72a.75.75 0 0 0-1.06 1.06l3 3Z" clip-rule="evenodd" />
                    </svg>
                </div>
                <p class="text-lg font-medium text-gray-600 mb-2">Monthly Highest Rainfall</p>
                <div class="number-display" id="highestRainfallVal">0.0</div>
                <p class="text-sm text-gray-500" id="highestRainfallInfo">in __ station in the month of __</p>
            </div>

            <!-- Monthly Average Rainfall Across Stations Box -->
            <div class="dashboard-box border-green-500">
                <div class="top-box-icon text-green-500">
                    <!-- SVG for average icon (chart bars) -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-12 h-12">
                        <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-.53 5.47a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 1 0 1.06 1.06L11.25 9.81v4.319c0 .414.336.75.75.75s.75-.336.75-.75V9.81l1.72 1.72a.75.75 0 1 0 1.06-1.06l-3-3Z" clip-rule="evenodd" />
                    </svg>
                </div>
                <p class="text-lg font-medium text-gray-600 mb-2">Monthly Average Rainfall Across Stations</p>
                <div class="number-display" id="averageRainfallVal">0.0</div>
                <p class="text-sm text-gray-500" id="averageRainfallInfo">Average of daily rainfall values per month</p>
            </div>
        </div>

        <!-- Horizontal line separator -->
        <hr class="my-10 border-t-2 border-gray-200">

        <!-- Monthly Minimum and Maximum Rainfall Section -->
        <h2 class="text-2xl font-bold text-center mb-6 text-gray-700">Monthly Minimum and Maximum Rainfall by Station</h2>
        <div id="monthlyMinMaxContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-10">
            <!-- Monthly min/max boxes will be dynamically inserted here by JavaScript -->
        </div>

        <!-- Horizontal line separator -->
        <hr class="my-10 border-t-2 border-gray-200">

        <!-- Monthly Total Rainfall Section -->
        <h2 class="text-2xl font-bold text-center mb-6 text-gray-700">Monthly Total Rainfall by Station</h2>
        <div id="monthlyTotalContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-10">
            <!-- Monthly total boxes will be dynamically inserted here by JavaScript -->
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        Dashboard created by Abdullah Al Mahmud with AI
    </footer>

    <script>
        // URL of the CSV data
        const CSV_URL = 'https://raw.githubusercontent.com/mahmudstat/open-analysis/refs/heads/main/data/bd_daily_rainfall_2024.csv';
        // Array of month names for display
        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        // Number of days in each month for 2024 (leap year)
        const daysInMonth = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

        /**
         * Parses a CSV string into an array of JavaScript objects.
         * Each row becomes an object with keys from the CSV headers.
         * @param {string} csv - The CSV data as a string.
         * @returns {Array<Object>} An array of objects representing the CSV data.
         */
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',').map(header => header.trim()); // Trim headers
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(value => value.trim()); // Trim values
                const row = {};
                headers.forEach((header, index) => {
                    row[header] = values[index]; // Assign raw string values
                });
                data.push(row);
            }
            return data;
        }

        /**
         * Returns an SVG icon representing sunshine intensity based on the month.
         * Mild sunshine for November, December, January, February. Strong for others.
         * @param {number} monthNum - The month number (1-12).
         * @returns {string} An SVG string for the sunshine icon.
         */
        function getSunshineIcon(monthNum) {
            // Mild sunshine for Nov-Feb (11, 12, 1, 2)
            if (monthNum === 11 || monthNum === 12 || monthNum === 1 || monthNum === 2) {
                return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8 text-yellow-400">
                            <path fill-rule="evenodd" d="M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75ZM7.5 12a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM18.894 6.106a.75.75 0 0 0-1.06-1.06l-1.591 1.59a.75.75 0 1 0 1.06 1.06l1.591-1.59ZM15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 0 0 1 7.5 0ZM11.25 18a.75.75 0 0 1 .75-.75h2.25a.75.75 0 0 1 0 1.5H12a.75.75 0 0 1-.75-.75ZM5.606 17.394a.75.75 0 0 0 1.06 1.06l1.591-1.59a.75.75 0 0 0-1.06-1.06l-1.591 1.59ZM3 12a.75.75 0 0 1 .75-.75h2.25a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm14.394 5.606a.75.75 0 0 0 1.06-1.06l-1.59-1.59a.75.75 0 0 0-1.06 1.06l1.59 1.59ZM6.106 5.606a.75.75 0 0 0-1.06 1.06l1.59 1.59a.75.75 0 0 0 1.06-1.06l-1.59-1.59Z" clip-rule="evenodd" />
                        </svg>`;
            }
            // Strong sunshine for other months
            return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8 text-orange-500">
                        <path d="M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75ZM7.5 12a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM18.894 6.106a.75.75 0 0 0-1.06-1.06l-1.591 1.59a.75.75 0 1 0 1.06 1.06l1.591-1.59ZM15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 0 0 1 7.5 0ZM11.25 18a.75.75 0 0 1 .75-.75h2.25a.75.75 0 0 1 0 1.5H12a.75.75 0 0 1-.75-.75ZM5.606 17.394a.75.75 0 0 0 1.06 1.06l1.591-1.59a.75.75 0 0 0-1.06-1.06l-1.591 1.59ZM3 12a.75.75 0 0 1 .75-.75h2.25a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm14.394 5.606a.75.75 0 0 0 1.06-1.06l-1.59-1.59a.75.75 0 0 0-1.06 1.06l1.59 1.59ZM6.106 5.606a.75.75 0 0 0-1.06 1.06l1.59 1.59a.75.75 0 0 0 1.06-1.06l-1.59-1.59Z" />
                    </svg>`;
        }

        /**
         * Loads, processes, and displays the rainfall data on the dashboard.
         */
        async function loadDashboard() {
            try {
                // Fetch the CSV data from the URL
                const response = await fetch(CSV_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const csvText = await response.text();
                const data = parseCSV(csvText);

                // Initialize variables for overall lowest/highest rainfall
                let overallLowestRainfall = Infinity;
                let overallLowestRainfallInfo = { value: 0, station: '', month: '' };
                let overallHighestRainfall = -Infinity;
                let overallHighestRainfallInfo = { value: 0, station: '', month: '' };

                // Arrays to store processed monthly data
                const monthlyMinMaxData = [];
                const monthlyTotalData = [];
                const monthlyAverageRainfallValues = []; // Stores average for each month

                // Loop through each month (1 to 12)
                for (let month = 1; month <= 12; month++) {
                    let monthMinRainfall = Infinity;
                    let monthMinStation = '';
                    let monthMaxRainfall = -Infinity;
                    let monthMaxStation = '';
                    let monthTotalRainfallSum = 0; // Sum of all rainfall for this month across all stations
                    let monthTotalDailyEntries = 0; // Count of valid daily entries for this month

                    // Filter data for the current month
                    const stationsInMonth = data.filter(row => parseInt(row.Month) === month);

                    let maxStationTotalForMonth = 0;
                    let stationWithMaxTotal = 'N/A';

                    // Process each station's data for the current month
                    stationsInMonth.forEach(row => {
                        const stationName = row.St_name;
                        let currentStationDailyTotal = 0; // Total rainfall for current station in this month

                        // Iterate through each day of the month
                        for (let day = 1; day <= daysInMonth[month - 1]; day++) {
                            const dayKey = `D_${String(day).padStart(2, '0')}`; // e.g., "D_01", "D_15"
                            const rainfall = parseFloat(row[dayKey]); // Convert rainfall to number

                            // Check if rainfall is a valid number
                            if (!isNaN(rainfall)) {
                                currentStationDailyTotal += rainfall; // Accumulate total for current station
                                monthTotalRainfallSum += rainfall; // Accumulate total for the month across all stations
                                monthTotalDailyEntries++; // Count valid daily entries

                                // Update overall lowest rainfall
                                if (rainfall < overallLowestRainfall) {
                                    overallLowestRainfall = rainfall;
                                    overallLowestRainfallInfo = { value: rainfall, station: stationName, month: monthNames[month - 1] };
                                }
                                // Update overall highest rainfall
                                if (rainfall > overallHighestRainfall) {
                                    overallHighestRainfall = rainfall;
                                    overallHighestRainfallInfo = { value: rainfall, station: stationName, month: monthNames[month - 1] };
                                }

                                // Update monthly min/max for the current month
                                if (rainfall < monthMinRainfall) {
                                    monthMinRainfall = rainfall;
                                    monthMinStation = stationName;
                                }
                                if (rainfall > monthMaxRainfall) {
                                    monthMaxRainfall = rainfall;
                                    monthMaxStation = stationName;
                                }
                            }
                        }

                        // Determine the station with the maximum total rainfall for this month
                        if (currentStationDailyTotal > maxStationTotalForMonth) {
                            maxStationTotalForMonth = currentStationDailyTotal;
                            stationWithMaxTotal = stationName;
                        }
                    });

                    // Store monthly min/max data for rendering
                    monthlyMinMaxData.push({
                        month: monthNames[month - 1],
                        minRainfall: monthMinRainfall === Infinity ? 0 : monthMinRainfall,
                        minStation: monthMinStation || 'N/A',
                        maxRainfall: monthMaxRainfall === -Infinity ? 0 : monthMaxRainfall,
                        maxStation: monthMaxStation || 'N/A',
                        monthNum: month // Store month number for icon selection
                    });

                    // Store monthly total data for rendering (highest total for any station in that month)
                    monthlyTotalData.push({
                        month: monthNames[month - 1],
                        totalRainfall: maxStationTotalForMonth,
                        station: stationWithMaxTotal,
                        monthNum: month // Store month number for icon selection
                    });

                    // Calculate average rainfall for the current month across all stations
                    if (monthTotalDailyEntries > 0) {
                        monthlyAverageRainfallValues.push(monthTotalRainfallSum / monthTotalDailyEntries);
                    } else {
                        monthlyAverageRainfallValues.push(0); // No data for this month
                    }
                }

                // Calculate the overall average rainfall across all months (average of monthly averages)
                const overallAverageRainfall = monthlyAverageRainfallValues.reduce((sum, val) => sum + val, 0) / monthlyAverageRainfallValues.length;


                // Populate the Top Summary Boxes with calculated data
                document.getElementById('lowestRainfallVal').textContent = overallLowestRainfallInfo.value.toFixed(2);
                document.getElementById('lowestRainfallInfo').textContent = `in ${overallLowestRainfallInfo.station} in ${overallLowestRainfallInfo.month}`;

                document.getElementById('highestRainfallVal').textContent = overallHighestRainfallInfo.value.toFixed(2);
                document.getElementById('highestRainfallInfo').textContent = `in ${overallHighestRainfallInfo.station} in ${overallHighestRainfallInfo.month}`;

                document.getElementById('averageRainfallVal').textContent = overallAverageRainfall.toFixed(2);

                // Populate the Monthly Min/Max Boxes
                const monthlyMinMaxContainer = document.getElementById('monthlyMinMaxContainer');
                monthlyMinMaxData.forEach(data => {
                    const box = document.createElement('div');
                    box.className = 'month-box border-purple-400'; // Apply specific border color
                    box.innerHTML = `
                        <div class="month-icon">${getSunshineIcon(data.monthNum)}</div>
                        <div class="month-content">
                            <p class="month-title">${data.month}</p>
                            <p class="text-sm text-gray-600">Min: <span class="month-data text-blue-700">${data.minRainfall.toFixed(2)}</span> (${data.minStation})</p>
                            <p class="text-sm text-gray-600">Max: <span class="month-data text-red-700">${data.maxRainfall.toFixed(2)}</span> (${data.maxStation})</p>
                        </div>
                    `;
                    monthlyMinMaxContainer.appendChild(box);
                });

                // Populate the Monthly Total Boxes
                const monthlyTotalContainer = document.getElementById('monthlyTotalContainer');
                monthlyTotalData.forEach(data => {
                    const box = document.createElement('div');
                    box.className = 'month-box border-teal-400'; // Apply specific border color
                    box.innerHTML = `
                        <div class="month-icon">${getSunshineIcon(data.monthNum)}</div>
                        <div class="month-content">
                            <p class="month-title">${data.month}</p>
                            <p class="text-sm text-gray-600">Total: <span class="month-data text-green-700">${data.totalRainfall.toFixed(2)}</span> (${data.station})</p>
                        </div>
                    `;
                    monthlyTotalContainer.appendChild(box);
                });

                // Hide loading spinner and show dashboard content
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('dashboard-content').classList.remove('hidden');

            } catch (error) {
                // Log and display error if data loading or parsing fails
                console.error('Error loading or parsing data:', error);
                document.getElementById('loading').innerHTML = '<p class="text-red-500 text-xl">Failed to load dashboard data. Please check the console for more details.</p>';
            }
        }

        // Load the dashboard when the window is fully loaded
        window.onload = loadDashboard;
    </script>
</body>
</html>
