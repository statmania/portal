<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bar Plot Generator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for a cleaner look */
        body {
            font-family: 'Inter', sans-serif;
            @apply bg-gray-50 text-gray-800;
        }
        canvas {
            display: block; /* Remove extra space below canvas */
            /* Removed height: calc(100% - 60px); to allow flex-grow to manage height */
            width: 100%;
        }
        input[type="text"], textarea {
            @apply w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500;
        }
        /* Updated button styling */
        button {
            @apply bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-2 px-6 rounded-lg shadow-lg hover:from-indigo-600 hover:to-purple-700 transition transform duration-200 ease-in-out hover:scale-105 active:scale-95 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 border border-indigo-700;
        }
        /* Style for the message box */
        #messageBox {
            @apply fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-75 z-50 hidden;
        }
        #messageBoxContent {
            @apply bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center;
        }
        #messageBoxButton {
            @apply mt-4 bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <h1 class="text-3xl font-bold text-center mb-6 md:mb-8 text-indigo-700">Custom Bar Plot Generator</h1>

    <!-- Main Container -->
    <div class="flex flex-col md:flex-row gap-6 md:gap-8 max-w-7xl mx-auto">

        <!-- Options Panel (Left/Top) -->
        <!-- Added max-h and overflow-y-auto for scrollability -->
        <div class="flex-shrink-0 w-full md:w-1/3 bg-white p-6 rounded-xl shadow-lg border border-gray-100 max-h-[calc(100vh-8rem)] overflow-y-auto">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Plot Settings</h2>

            <div class="mb-4">
                <label for="valuesInput" class="block text-sm font-medium text-gray-700 mb-1">Values (comma-separated numbers):</label>
                <input type="text" id="valuesInput" value="50,70,30,90,60" placeholder="e.g., 10,20,30">
                <p class="text-xs text-gray-500 mt-1">Example: 50,70,30,90,60</p>
            </div>

            <div class="mb-4">
                <label for="categoriesInput" class="block text-sm font-medium text-gray-700 mb-1">Categories (comma-separated text):</label>
                <input type="text" id="categoriesInput" value="A,B,C,D,E" placeholder="e.g., Apples,Oranges,Bananas">
                <p class="text-xs text-gray-500 mt-1">Example: A,B,C,D,E</p>
            </div>

            <!-- Input fields for Plot Title, X-Axis Label, Y-Axis Label -->
            <div class="mb-4">
                <label for="plotTitleInput" class="block text-sm font-medium text-gray-700 mb-1">Plot Title:</label>
                <input type="text" id="plotTitleInput" value="Sample Bar Chart" placeholder="e.g., Sales by Region">
            </div>

            <div class="mb-4">
                <label for="xAxisLabelInput" class="block text-sm font-medium text-gray-700 mb-1">X-Axis Label:</label>
                <input type="text" id="xAxisLabelInput" value="Categories" placeholder="e.g., Product Types">
            </div>

            <div class="mb-4">
                <label for="yAxisLabelInput" class="block text-sm font-medium text-gray-700 mb-1">Y-Axis Label:</label>
                <input type="text" id="yAxisLabelInput" value="Values" placeholder="e.g., Quantity Sold">
            </div>

            <div class="mb-4">
                <label for="colorsInput" class="block text-sm font-medium text-gray-700 mb-1">Colors (optional, comma-separated, accepts hex/named colors):</label>
                <input type="text" id="colorsInput" value="#6366F1,#8B5CF6,#EC4899,#F59E0B,#10B981" placeholder="e.g., red,blue,#FFC0CB">
                <p class="text-xs text-gray-500 mt-1">Example: #6366F1,#8B5CF6,#EC4899,#F59E0B,#10B981</p>
            </div>

            <div class="mb-6">
                <label for="widthsInput" class="block text-sm font-medium text-gray-700 mb-1">Bar Widths (optional, comma-separated percentages 0-100):</label>
                <input type="text" id="widthsInput" value="80,70,90,75,85" placeholder="e.g., 70,80,90">
                <p class="text-xs text-gray-500 mt-1">Example: 80,70,90,75,85 (0-100%)</p>
            </div>

            <button id="generatePlotBtn" class="w-full">Generate Plot</button>
        </div>

        <!-- Chart Container (Right/Bottom) -->
        <!-- Added flex-col to stack canvas and button -->
        <div class="flex-grow bg-white p-4 rounded-xl shadow-lg border border-gray-100 flex flex-col items-center justify-center min-h-[300px] md:min-h-[500px]">

            <canvas id="barChartCanvas" class="flex-grow"></canvas>
            <!-- Moved button for sorting below the canvas -->
            <!-- Added w-fit and mx-auto for centering and content-based width -->
            <div class="mt-4 w-full flex justify-center px-4">
                <button id="sortAscendingBtn" class="bg-blue-500 hover:bg-blue-600">Sort Ascending</button>
            </div>
        </div>
    </div>

    <!-- Message Box for alerts -->
    <div id="messageBox">
        <div id="messageBoxContent">
            <p id="messageBoxText" class="text-lg font-medium mb-4"></p>
            <button id="messageBoxButton">OK</button>
        </div>
    </div>

    <script>
        // Get references to DOM elements
        const valuesInput = document.getElementById('valuesInput');
        const categoriesInput = document.getElementById('categoriesInput');
        const plotTitleInput = document.getElementById('plotTitleInput');
        const xAxisLabelInput = document.getElementById('xAxisLabelInput');
        const yAxisLabelInput = document.getElementById('yAxisLabelInput');
        const colorsInput = document.getElementById('colorsInput');
        const widthsInput = document.getElementById('widthsInput');
        const generatePlotBtn = document.getElementById('generatePlotBtn');
        const sortAscendingBtn = document.getElementById('sortAscendingBtn');
        const barChartCanvas = document.getElementById('barChartCanvas');
        const ctx = barChartCanvas.getContext('2d');

        // Message Box elements
        const messageBox = document.getElementById('messageBox');
        const messageBoxText = document.getElementById('messageBoxText');
        const messageBoxButton = document.getElementById('messageBoxButton');

        // Flag to indicate if the currently displayed chart is sorted
        let currentChartIsSorted = false;

        // Function to show custom message box
        function showMessageBox(message) {
            messageBoxText.textContent = message;
            messageBox.classList.remove('hidden');
        }

        // Event listener for message box button
        messageBoxButton.addEventListener('click', () => {
            messageBox.classList.add('hidden');
        });

        // Default colors for the bars
        const defaultColors = [
            '#6366F1', // Indigo
            '#8B5CF6', // Violet
            '#EC4899', // Pink
            '#F59E0B', // Amber
            '#10B981', // Emerald
            '#3B82F6', // Blue
            '#EF4444', // Red
            '#06B6D4', // Cyan
            '#6B7280'  // Gray
        ];

        /**
         * Draws a bar chart on the canvas.
         * @param {HTMLCanvasElement} canvas - The canvas element to draw on.
         * @param {CanvasRenderingContext2D} ctx - The 2D rendering context of the canvas.
         * @param {number[]} values - Array of numerical values for the bars.
         * @param {string[]} categories - Array of category labels for the bars.
         * @param {string} plotTitle - Title of the plot.
         * @param {string} xAxisLabel - Label for the X-axis.
         * @param {string} yAxisLabel - Label for the Y-axis.
         * @param {string[]} colors - Array of colors for each bar.
         * @param {number[]} widths - Array of widths (0-100%) for each bar relative to available space.
         */
        function drawBarChart(canvas, ctx, values, categories, plotTitle, xAxisLabel, yAxisLabel, colors, widths) {
            // Clear the canvas before drawing
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Get canvas dimensions
            const canvasWidth = canvas.width;
            const canvasHeight = canvas.height;

            // Define padding and margins for the chart
            // Adjusted padding to account for title and axis labels
            const topPadding = 50;
            const bottomPadding = 40; // For X-axis label
            const leftPadding = 60; // For Y-axis label
            const rightPadding = 20;

            const chartAreaWidth = canvasWidth - leftPadding - rightPadding;
            const chartAreaHeight = canvasHeight - topPadding - bottomPadding;
            const barSpacing = 15; // Spacing between bars

            // Calculate the maximum value for scaling the bars
            const maxValue = Math.max(...values);
            // If all values are non-positive or no values, clear canvas and return
            if (values.length === 0 || maxValue <= 0) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                return;
            }

            // Calculate bar width based on number of bars and spacing
            const numBars = values.length;
            const availableBarWidthSpace = chartAreaWidth - (numBars - 1) * barSpacing;
            const baseBarWidth = availableBarWidthSpace / numBars;

            // Draw Plot Title
            ctx.fillStyle = '#1F2937'; // Dark gray
            ctx.font = 'bold 18px Inter';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            ctx.fillText(plotTitle, canvasWidth / 2, 15);

            // Draw Y-axis (values)
            ctx.beginPath();
            ctx.moveTo(leftPadding, topPadding);
            ctx.lineTo(leftPadding, canvasHeight - bottomPadding);
            ctx.strokeStyle = '#374151'; // Dark gray for axis
            ctx.lineWidth = 2;
            ctx.stroke();

            // Draw X-axis (categories)
            ctx.beginPath();
            ctx.moveTo(leftPadding, canvasHeight - bottomPadding);
            ctx.lineTo(canvasWidth - rightPadding, canvasHeight - bottomPadding);
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Draw Y-axis labels and tick marks
            const numYLabels = 5; // Number of labels on Y-axis
            for (let i = 0; i <= numYLabels; i++) {
                const value = (maxValue / numYLabels) * i;
                const y = canvasHeight - bottomPadding - (value / maxValue) * chartAreaHeight;

                ctx.fillStyle = '#4B5563'; // Gray for text
                ctx.font = '12px Inter';
                ctx.textAlign = 'right';
                ctx.textBaseline = 'middle';
                ctx.fillText(Math.round(value), leftPadding - 5, y); // Label

                // Tick mark
                ctx.beginPath();
                ctx.moveTo(leftPadding, y);
                ctx.lineTo(leftPadding + 5, y);
                ctx.strokeStyle = '#9CA3AF'; // Light gray for tick marks
                ctx.lineWidth = 1;
                ctx.stroke();
            }

            // Draw Y-axis Label
            ctx.save(); // Save the current canvas state
            ctx.translate(leftPadding - 40, canvasHeight / 2); // Move origin to desired text position
            ctx.rotate(-Math.PI / 2); // Rotate 90 degrees counter-clockwise
            ctx.fillStyle = '#1F2937'; // Dark gray
            ctx.font = '14px Inter';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(yAxisLabel, 0, 0);
            ctx.restore(); // Restore the canvas state

            // Draw X-axis Label
            ctx.fillStyle = '#1F2937'; // Dark gray
            ctx.font = '14px Inter';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            ctx.fillText(xAxisLabel, leftPadding + chartAreaWidth / 2, canvasHeight - bottomPadding + 25);


            // Draw bars
            let currentX = leftPadding; // Starting X position for the first bar
            for (let i = 0; i < numBars; i++) {
                const value = values[i];
                const category = categories[i] || `Category ${i + 1}`;
                const color = colors[i] || defaultColors[i % defaultColors.length]; // Use default colors if not provided
                const barPercentageWidth = widths[i] !== undefined ? widths[i] / 100 : 0.8; // Default 80% if not provided

                // Calculate bar height based on value
                const barHeight = (value / maxValue) * chartAreaHeight;

                // Calculate actual bar width
                const barActualWidth = baseBarWidth * barPercentageWidth;

                // Center the bar within its allocated space
                const x = currentX + (baseBarWidth - barActualWidth) / 2;
                const y = canvasHeight - bottomPadding - barHeight;

                // Draw the bar
                ctx.fillStyle = color;
                ctx.fillRect(x, y, barActualWidth, barHeight);
                ctx.strokeStyle = color; // Border same color
                ctx.lineWidth = 1;
                ctx.strokeRect(x, y, barActualWidth, barHeight); // Add a subtle border

                // Draw category label below the bar
                ctx.fillStyle = '#4B5563'; // Gray for text
                ctx.font = '12px Inter';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'top';
                ctx.fillText(category, x + barActualWidth / 2, canvasHeight - bottomPadding + 5);

                // Draw value label above the bar
                ctx.fillStyle = '#1F2937'; // Darker gray for value text
                ctx.font = '12px Inter';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'bottom';
                ctx.fillText(value, x + barActualWidth / 2, y - 5);

                // Move to the next bar's starting position
                currentX += baseBarWidth + barSpacing;
            }
        }

        /**
         * Parses a comma-separated string into an array of numbers.
         * @param {string} inputString - The input string.
         * @returns {number[]} Array of numbers.
         */
        function parseNumbers(inputString) {
            return inputString.split(',').map(s => parseFloat(s.trim())).filter(n => !isNaN(n));
        }

        /**
         * Parses a comma-separated string into an array of strings.
         * @param {string} inputString - The input string.
         * @returns {string[]} Array of strings.
         */
        function parseStrings(inputString) {
            return inputString.split(',').map(s => s.trim()).filter(s => s.length > 0);
        }

        /**
         * Sorts the bar data (values, categories, colors, widths) in ascending order based on values.
         * Maintains correspondence between elements.
         * @param {number[]} values - Original array of values.
         * @param {string[]} categories - Original array of categories.
         * @param {string[]} colors - Original array of colors.
         * @param {number[]} widths - Original array of widths.
         * @returns {object} An object containing the sorted arrays.
         */
        function sortDataAscending(values, categories, colors, widths) {
            // Create an array of objects to keep data linked during sorting
            const data = values.map((value, index) => ({
                value: value,
                category: categories[index],
                color: colors[index],
                width: widths[index]
            }));

            // Sort the data array based on the 'value' property in ascending order
            data.sort((a, b) => a.value - b.value);

            // Extract the sorted arrays
            const sortedValues = data.map(item => item.value);
            const sortedCategories = data.map(item => item.category);
            const sortedColors = data.map(item => item.color);
            const sortedWidths = data.map(item => item.width);

            return {
                values: sortedValues,
                categories: sortedCategories,
                colors: sortedColors,
                widths: sortedWidths
            };
        }

        /**
         * Generates and draws the plot based on user input.
         * @param {string} [source='input'] - Indicates what triggered the plot generation (e.g., 'input', 'generateButton', 'sortButton').
         */
        function generatePlot(source = 'input') {
            let values = parseNumbers(valuesInput.value);
            let categories = parseStrings(categoriesInput.value);
            let colors = parseStrings(colorsInput.value);
            let widths = parseNumbers(widthsInput.value); // These should be percentages (0-100)
            const plotTitle = plotTitleInput.value;
            const xAxisLabel = xAxisLabelInput.value;
            const yAxisLabel = yAxisLabelInput.value;

            // --- Validation ---
            const hasEnoughData = values.length > 0 && categories.length > 0 && values.length === categories.length;
            const hasValidWidths = !widths.some(w => w < 0 || w > 100);

            if (!hasEnoughData || !hasValidWidths) {
                // Clear plot if invalid data, but only show message box for explicit clicks
                if (source === 'generateButton') { // Only show message for manual generate click
                    if (values.length === 0) showMessageBox("Please enter at least one value.");
                    else if (categories.length === 0) showMessageBox("Please enter at least one category.");
                    else if (values.length !== categories.length) showMessageBox("Number of values must match the number of categories.");
                    else if (!hasValidWidths) showMessageBox("Bar widths must be between 0 and 100.");
                }
                ctx.clearRect(0, 0, barChartCanvas.width, barChartCanvas.height);
                // Ensure sort button state is reset if data becomes invalid
                currentChartIsSorted = false;
                sortAscendingBtn.textContent = 'Sort Ascending';
                return; // Stop execution if data is invalid
            }

            // --- Sorting Logic ---
            // If any input changes, or generate button is clicked, we reset the sorted state
            if (source === 'input' || source === 'generateButton') {
                currentChartIsSorted = false;
                sortAscendingBtn.textContent = 'Sort Ascending'; // Reset button text
            } else if (source === 'sortButton') {
                // Toggle the sorted state when the sort button is pressed
                currentChartIsSorted = !currentChartIsSorted;
                sortAscendingBtn.textContent = currentChartIsSorted ? 'Unsort' : 'Sort Ascending';
            }

            // Apply sorting if the chart should currently be sorted
            if (currentChartIsSorted) {
                const sortedData = sortDataAscending(values, categories, colors, widths);
                values = sortedData.values;
                categories = sortedData.categories;
                colors = sortedData.colors;
                widths = sortedData.widths;
            }

            // Ensure canvas size is set to its CSS size
            // Use computed style to get accurate rendered dimensions
            const computedStyle = getComputedStyle(barChartCanvas);
            barChartCanvas.width = parseFloat(computedStyle.width);
            barChartCanvas.height = parseFloat(computedStyle.height);

            drawBarChart(barChartCanvas, ctx, values, categories, plotTitle, xAxisLabel, yAxisLabel, colors, widths);
        }

        // Event listener for the generate button
        generatePlotBtn.addEventListener('click', () => generatePlot('generateButton'));

        // Event listener for the sort ascending/unsort button
        sortAscendingBtn.addEventListener('click', () => generatePlot('sortButton'));

        // Add input event listeners to all relevant input fields for live updates
        valuesInput.addEventListener('input', () => generatePlot('input'));
        categoriesInput.addEventListener('input', () => generatePlot('input'));
        plotTitleInput.addEventListener('input', () => generatePlot('input'));
        xAxisLabelInput.addEventListener('input', () => generatePlot('input'));
        yAxisLabelInput.addEventListener('input', () => generatePlot('input'));
        colorsInput.addEventListener('input', () => generatePlot('input'));
        widthsInput.addEventListener('input', () => generatePlot('input'));


        // Function to resize canvas and redraw chart on window resize
        function resizeCanvasAndRedraw() {
            // Get the computed dimensions after layout
            const computedStyle = getComputedStyle(barChartCanvas);
            const displayWidth = parseFloat(computedStyle.width);
            const displayHeight = parseFloat(computedStyle.height);

            // Set the canvas drawing buffer resolution
            barChartCanvas.width = displayWidth;
            barChartCanvas.height = displayHeight;

            // Call generatePlot with 'resize' source to redraw, keeping current sort state
            // This ensures the chart redraws correctly on resize while preserving the sort state
            generatePlot('resize');
        }

        // Initial plot generation when the page loads
        window.onload = function() {
            resizeCanvasAndRedraw(); // Ensure canvas is sized correctly and initial plot is drawn
        };

        // Add event listener for window resize
        window.addEventListener('resize', resizeCanvasAndRedraw);

    </script>
</body>
</html>
